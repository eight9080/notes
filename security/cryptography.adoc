ifndef::imagesdir[:imagesdir: ../images]
:toc:
= Cryptography

== Purpose
- Nonrepudiation - can't claim it was not send by you
- Integrity - is the data you sent
- Authentication
- Confidentiality

=== Process
Plaintext + Encryption = Chiphertext
Chipertext + Descryption = Plaintext

Entropy - how random is a number

- One-time Pad
Truly random, used only once, maximum entropy +
hard to use

Diffie Hellman -  is a method of securely exchanging cryptographic keys over a public channel
Large primes - 2048 bits +
Man in the Middle attack

== Types of Cryptography
=== Symmetric
Pro

- both parties use the same key
- super fast
- easy to implement
- key isn't transmitted with data

Not good

- key has to be distributed to all parties
- manageability
- look out for Dictionary Attacks
- hard to prove authenticity

=== Asymmetric
Pro

- two keys required (public and private)
- digital signature
- better security
- private key - proves your identity
- public key - sends you encrypted data

Not good

- slower and more CPU power
- not good id the private key is exposed
- MiTM and Brute force attacks
- No decryption if the private key is lost

Government Access to Key (GAK)

== Ciphers

Block ciphers - divides message into blocks (same size) - encrypts each block individual. +
Whereas confusion serves to hide the key, diffusion serves to hide patterns within the original message.

=== Initialization vector
to initialize the cipher block chain with a *random* vector each time we encrypt a message. +
This initialization vector is the *same size as our block size* and gives us a random starting point for our cipher block chaining.


Types: Classical and Modern

Classical: Substitution, Transposition

Modern: Symmetric, Asymmetric, Block, Stream

Algorithms:

DES - Data Encryption Standard
64-bit blocks, 56-bit key for encryption/decryption


3DES - 3 des with 3 keys (K1, K2, K3)

==== AES - Advanced Encryption Standard
AES - Advanced Encryption Standard - symmetric key algorithm
128-bit(16 bytes) blocks , 128/192/256 bit keys
- encrypting data that is not classified +
Rounds include key expansion, XORing the round key, substitution, shifting rows, and mixing columns. +


RC4 - variable key size, symmetric
- not that good, was used part of wep

Blowfish - symmetric block
- same key to encrypt/decrypt
- 64-bit blocks, 32-448 bit key
- advantage - speed

Twofish - 128-bit block
- 256-bit key
- single key

Compression and Error Correction


== Standards and Protocols

DSA - 320-bit for signatures/512-1024 bit for security/ Private-Public keys

RSA - Uses two large prime numbers

Deffie-Hellman - Allows two parties to form a shared key over a public network

== Hashes
- check a document was not changed
- a document receives a digital signature
- Message Digest - MD - 128-bit hash value (foundation MD2, MD4,MD5)
- SHA-1 - Secure Hash Algorithm - takes the input -> 160-bit -> hex, used with PGP, TLS, SSH, SSL
- SHA-2 - similar tu SHA1-1, stronger
- SHA-3 - sponge construction, XORed

Tool: Sysinternals

=== Designed for Messages
HMAC - embedded hash function
CHAP - PPP, 3-way handshake
EAP - Passwords, One-Time passwords(OTP), ID cards, Smart Tokens

== Cryptography tools

=== MD5 Hash Calculators
- bullzip.com
- nirsoft.net
- onlinemd5.com
- Microsoft FCIV

=== Folder/Files
- EFS - from windows
- 7zip
- GnuPG -- Windows Kleopatra, create new key pair
- AxCrypt

=== Drives
- BitLocker
- VeraCrypt
- FileVault
- GNOME Disk Utility

=== Mobile devices
- MD5 Checker
- Hash Droid
- Last Pass

== PKI Public Key Infrastructure
- Asymmetric Using Two keys
- Certificate management System - CMS
- Digital certificates
- Validation Authority (VA)
- Certificate Authority (CA) - issues/verifies certificates
- Registration Authority (RA) - verifies the CAs

Encrypt a message with a public key of the receiver.
Receiver uses the private key to decrypt the email and read it.

CA - issues digital certificates - trusted 3rd party
Verisign, thawte, Entrust, GoDady, DigiCert
- issues, revoking, distributes certificates

Certificate - identifying a user/org, public key, alg, issuer, subject name

Signed certificate - signed by a public CA, private key is kept secret by the CA
Self-signed certificate - signed by the same org

== Encrypting Emails, File and Disk drives

== Java Cryptography Extensions JCE
*KeyGenerator* generates *SecretKeys* +
SecretKeys are used for symmetric encryption algorithms like AES.

On the asymmetric side -> *KeyPairGenerator* gives a *PublicKey and a PrivateKey*.

Also at this generative level we have *SecureRandom* - a cryptographically strong random number generator and *IvParameterSpec* - an initialization vector for block ciphers. +
The keys in the initialization vectors go into creating *Cipher* and *Signature* classes - perform the work of the symmetric or asymmetric encryption and signatures +
CipherInputStream and CipherOutputStream -  Java input and output stream pipeline in order to pass an entire message through a block cipher.

=== Symmetric encryption JCE
image::SymmetricEncrypt.PNG[Symmetric encryption]
Source https://app.pluralsight.com/library/courses/cryptography-fundamentals-java-dotnet-developers[Symmetric encryption]

image::SymmetricDecrypt.PNG[Symmetric decryption]
Source https://app.pluralsight.com/library/courses/cryptography-fundamentals-java-dotnet-developers[Symmetric decryption]
link:DataEncryptionExample.adoc#sym-encrypt[Symmetric encryption]

=== Asymmetric encryption JCE
image::AsymmetricEncrypt.PNG[Asymmetric encryption]
Source https://app.pluralsight.com/library/courses/cryptography-fundamentals-java-dotnet-developers[Asymmetric encryption]

image::AsymmetricDecrypt.PNG[Asymmetric decryption]
Source https://app.pluralsight.com/library/courses/cryptography-fundamentals-java-dotnet-developers[Asymmetric encryption]

link:DataEncryptionExample.adoc#asym-encrypt[Asymmetric encryption]

=== Digital Signatures
Verify an email was send by the real person.
The email is signed with the private key of the sender,
and is verified with the public key of the sender by the receiver.

Confidentiality.
- encrypt a message and then send the secret key that we used to encrypt the message to just the person that we want to be able to read it.
- encrypt symmetric key with public key
- confidence that only recipient can read it

Authenticity
- guarantee that the message came from a particular source.
- to take a digest of the original message.
- *A digest* is simply a *hash*, a smaller number computed from the larger message.
- Using our private key, we can encrypt the digest, which digitally signs the original message.
- The recipient can compute the same digest using the hash function and then decrypt our signature using our public key.
- If the two match, then the signature is valid. So in order for this to work, we have to choose an *appropriate hashing function*.

- CRC-32* - CRC is Cyclic Redundancy Check
- 32 means that this hash produces a 32 bit number.
- CRC-32 is a polynomial on 33 bits, but only 32 bits of the result are stored.
- this polynomial is easily reversible.

==== Hashing Algorithms
Both the SHA-2 and the SHA-3 family are considered cryptographically secure.




=== SSL Secure Sockets Layer
- private channel
- authenticated channel
- reliable channel
- uses asymmetric and symmetric

[%hardbreaks]
Client sends Client Hello + random number + cipher alg supported
Server replies Server Hello + select alg + random number (ask certificate from the client)
Client - creates a random pre master secret and encrypts with the public key of the server
Client + server - generate a new master secret and session id based on the pre master secret
Client - send change cipher spec based on the master secret
Server - symmetric encryption based on the new master secret
Secure channel established

OpenSSL

- open source
- private/public keys
- certificates
- S/MIME
- Time stamps

The Heartbleed Bug is a serious vulnerability in the popular OpenSSL cryptographic software library. This weakness allows stealing the information protected, under normal conditions, by the SSL/TLS encryption used to secure the Internet.

==== X.509 Certificate


==== Pretty Good Privacy (PGP)

- encrypting messages and files
- signing
- deleting files
- compression

1. User encrypts data -> PGP uses compression
2. PGP creates a random key and encrypts the plaintext
3. Random key is encrypted with the recipient's public key
4. Random key is attached and sent to the recipient


=== Cryptanalysis methods

Linear
- block ciphers, plaintext attack, more pairs = better successful

Differential
- symmetric key algorithms
- looks at the differences of input and output


Integral
- block ciphers
- looks at pairs of input that differ a bit

==== Code breaking methods
- Frequency analysis
- Brute force

- Trickery and deceit

=== Best practice
- No keys inside the source code
- Do not transfer keys
- Symmetric algorithms use 168 or 265 bits
- Message authentication should be done
- Asymmetric algorithms use 1536 or 2048 bits
- Hash algorithms use 168 or 256 bits











